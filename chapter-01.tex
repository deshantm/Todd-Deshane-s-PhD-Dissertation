%  chapter-01.tex

\chapter{Introduction}

\section{Motivation}

General purpose computing devices, such as personal computers (PCs) or smartphones, and the operating systems that run on them provide more functionality and capabilities then most users will ever want or need. For example, these computing devices can send large quantities of emails or messages in seconds (on a scale proportional to the network bandwidth and computer power). A user is unlikely to ever need to send as many messages in a lifetime as their computing device could send in a day. On the contrary, malicious software (malware) seeks to take advantage of any spare computing power that it can control, making full use of the often spare functionality that general purpose computing devices and operating systems provide. One clear example of this phenomenon is the commonly accepted and reported fact that over 90\% of all email is spam\cite{spamcraft_2009}.

Too much of the burden of keeping a computer system secure is placed on the end users. Users are often required to keep the operating system, applications, security software, and anti-virus definitions up-to-date. Non-malicious or accidental incidents, such as system or software updates, can cause more noticeable problems to users and, in the worse case, can make the system unusable~\cite{MSRC_XP_blue_screen_2010, Krebs_2010, Tech_World_2005, Japan_Times_2005}. As a result, users often disable or refuse to perform updates~\cite{The_Register_2009, Microsoft_TechNet_2010, MS_SIR_2009}. Even with all the latest security updates, users are still susceptible to zero day exploits, which are exploits that have not been seen before and thus are not detected or protected against by traditional security software. 

When an end user falls victim to any sort of malware, such as a virus, a commonly recommended course of action is to make backups of any critical data and then to wipe the system completely and re-install. Throwing the computer away and buying a new one is considered by some to be an easier and more worthwhile task than getting rid of the malware through convention means~\cite{NewYork_Times_2005, KOMU-TV_2010}. Not only can malware take down the system, but it can cause the user to lose personal data, such as pictures or documents. The most diligent of users will make sure the latest updates are installed, keep backups of their personal data, and be careful not to click on anything suspicious. Taking these defensive measures can reduce the chance of system downtime and data loss, but require significant effort on the part of the user. Several recent studies indicate that most users are unwilling to perform updates nor back up their systems~\cite{ Acronis_2009, The_Register_2009, Microsoft_TechNet_2010}. Other studies indicate that many users are unable to adequately access risk and will make poor security decision to attain their goals\cite{sunshine_wolf_2009, motiee_chi_2010}.

Fully restoring a compromised system can be an agonizing process often involving re-installing the operating system and user applications. This can take hours or days even with all the proper materials readily on hand. For average users, even assembling the installation materials (for example, CDs, manuals, and configuration settings) may be an overwhelming task, not to mention correctly installing and configuring each piece of software.
 
To make matters worse, the process of restoring a compromised system to a usable state can frequently result in the loss of any personal data stored on the system. From the userâ€™s perspective, this is often the worst outcome of an attack. System data may be challenging to restore, but it can be restored from public sources. Personal data, however, can only be restored from private backups and the vast majority of personal computer users do not routinely backup their data. Once lost, personal data can only be recovered through repeated effort (for example, rewriting a report) and in some cases can never be recovered (for example, digital photos of a one time event).

\subsection{The Current State of Malware}

A trusting, naive design of the Internet and powerful, general purpose, commodity computer systems have led to wide-spread security problems. The Internet was originally developed by and for the government and universities and it was used in a trusting manner to share information among themselves. The explosive growth of the world wide web, starting in the 1990s\cite{Paxson_growthtrends_1994}, brought with it millions of Internet users, not all of which had benign intentions. Malicious hackers\footnote{Malicious hackers are more accurately defined as crackers (http://catb.org/jargon/html/C/cracker.html), but the term hacker is commonly (mis)-used in common practice.} exploited an Internet that wasn't built with security in mind. To make matters worse, the default configuration of the most popular operating system of the time was for users to run with full administrative privileges. Thus, a virus that ran as the user had full access to the system. Since that time, many security measures, such as public-key cryptography, firewalls, and intrusion detection systems, have been added to the Internet infrastructure. Commodity operating systems have also added security features, such as built-in firewalls, user access control, and system restore.

Despite these efforts, global scale security problems, such as widespread malware and botnet activity~\cite{conficker_09, special_ops_09,massive_botnet_09, iBotnet_09, leet09_malware, zombie_computers_nytimes_07}, still exist. The first computer worm of 1988 exploited several widely used programs and due to limited system security and an overall trusting Internet infrastructure, it was able to spread quickly across much of the Internet causing much disruption~\cite{Spafford_1989}. Computer malware in the early days was often the work of curious, playful, or politically-motivated individuals seeking to exploit for experimentation, exploration, prank, or vandalism. This early malware generally led to minor disruption and annoyance, but rarely led to much damage or loss to individuals or organizations. However, modern malware, particularly over the past decade or so, has been primarily used by organized crime to exploit and profit from trusting users and all kinds of organizations\cite{paxson_sellingviagra_2009, verizon_data_breach_report_08, verizon_data_breach_report_09,verizon_data_breach_report_10}.

Organized crime has set up shop all across the Internet, often in the form of botnets and black markets. Botnets are a distributed network of computers controlled remotely by malicious atackers that can be put into action on demand to perform distributed denial-of-service (DDoS) attacks on targeted websites, engage in mass e-mailer spam campaigns to sell pharmaceuticals, or promote the page rank of other hijacked sites. All of these actions can be taken by malicious hackers in an effort to exploit more users and systems in order to increase profits and the size of their botnets.

There is a growing black market of professional malware and exploit kits, which often even come with tech support\cite{paxson_sellingviagra_2009}! These exploit kits consist of various automated tools that can be used to trick and exploit users across the world. An example exploit kit might include a tool that does automated account creation and performs fake use of a popular social networking websites, such as Facebook or Twitter. The tool could then also have support for controlling fake or stolen accounts by a botnet. These accounts could then be used carefully and deceitfully to gain trust among real social networking users in order to serve them targeted spam links or hijack their personal information with phishing techniques. Profit can then be made by, for example, using the personal information for identity theft, link-referral affiliate programs, and tricking users to click on the various spam links~\cite{paxson_sellingviagra_2009}.

Another common method used to spread malware is by using drive-by-downloads. Drive-by-downloads are a method of attack that tricks users into visiting sites by using spam links or typo-squatting (registering commonly misspelled domains) and automatically installing malicious binaries. Another very related attack method is tricking users to click to install fake plugins or fake antivirus that are actually malware\cite{provos_2007}. These malware-infected computers are then used in the botnets to exploit more users and systems in various ways.

Over time, security of software improves and users are trained to be on the lookout, thus forcing malicious hackers to find new ways to spread their malware. For instance, a more recent trend is to use search engine optimization (SEO) tricks to promote malware sites to the top of the search results for trendy and popular search terms. A user searching for Bill Clinton to find out about his recent heart operation would likely have found themselves downloading fake anti-virus that is actually malware~\cite{eWeek_2010}. Fake anti-virus was found to account for 15% of all malware detected on the web using Google malware detection infrastructure in a recent study\cite{rajab_2010}. The specific details of these various types of attacks have changed, but the general nature of the attacks has not. Attackers rely on exploiting systems or tricking users to spread their malware. The attacks will target whatever is popular, which might mean Facebook or Twitter today, but could mean other popular technologies, such as smart phones or new web-based applications, in the near future.

These attacks are not slowing down and are likely to only get more sophisticated~\cite{wired_2010, damballa_2010,damballa_blog_2010}. The same tricks have been used by malicious hackers for quite some time, which leads us to question why do they still work? The answer centers around the fact that general purpose operating systems are still designed to allow the applications that run on them to run with the full privileges of the user. For instance, if a user has access to read, write, or delete a file, then any application run by that user has access to read, write, or delete that file. This is not a new problem. Researchers realized this problem over 20 years ago~\cite{Lai_88}, yet the vast majority of users still don't have their applications restricted in an effective and usable way. In Chapter 2, we will explore some of the options available today that are lacking in comparison to the solution described in this dissertation.

\subsection{Challenges to Change}

So why is there still not a solution to this problem used in practice? One reason is that a solution to this problem does not seem to fit in anybody's business model. Fixing the problem does not sell new computers, it does not sell new versions of operating systems, and it definitely does not sell new versions of security software, such as anti-virus and anti-malware. Software companies, such as Microsoft, claim that making use of automatic updates is one of the most effective things that an organization can use to help prevent the spread of malware\cite{MS_SIR_2009}. Some companies in the malware defense business recommend following the same old security best practices \cite{cto_roundtable_malware_defense_2010} even in the face of new and more subtle threats that can even affect people visiting legitimate sites\cite{NewYork_Times_2009}. Other anti-virus companies tend to take a band-aid type approach, claiming that they can keep ahead of the attackers with automated security updates and by employing new technologies\cite{Enterprise_IT_Planet_2009}.

Another reason that there is still a security problem on desktop computers is that even when reasonable solutions exist, they are rarely used in common practice. For example, mandatory access control (MAC) systems, such as SELinux~\cite{loscocco_2001}, AppArmor~\cite{AppArmor_2006}, and Windows Mandatory Integrity Control (MIC) \cite{mandatory_integrity_control}, go a long way toward solving the problem, but are not commonly used in practice. These protections are hard to use and tend to produce too many false positives, which often leads to them being disabled. In a study by Sunshine et. al., it was shown that users often incorrectly understand the risk involved with SSL warnings in the browser. Another study by Motiee et. al. showed that user's made incorrect security decisions when using Windows access control protections\cite{motiee_chi_2010}. These two studies are examples that demonstrate user's tendencies to do whatever it takes (despite the security risk) to complete their task~\cite{sunshine_wolf_2009}.

Other challenges to adoption of viable solutions require the software to reach a critical mass of users.  As we'll show in chapter 2 on related work, there are many proposed solutions in research that are unlikely to ever be used in practice. The critical issue is that the software needs to be usable for a wide variety of users. Even if the software both solves the problem and is usable, that does not imply that it is able to be easily distributed. An effective means of distribution may require original equipment manufacture (OEM) agreements or resource and time investment in infrastructure and staff to develop and foster user and developer communities. In any case, taking ideas that fundamentally change and improve how a large majority of computer users work is a significant undertaking.

Despite these challenges to change we hope that the approach described in this dissertation changes the way users, developers, and security professionals think about the security of computer systems. The solution proposed in this dissertation uses well-understood security practices and makes use some of the latest innovations in virtualization technology on commodity desktop systems. We demonstrate a desktop system that provides resistance against attack, fast recovery from exploits, and minimizes the impact any single exploited application can have on the system and user-specific data.

\subsection{An Overview of Our Approach}

Our solution is based on separating user data into a file server virtual machine (FS-VM) and accessing that data with virtual machine appliances, or simply virtual appliances, which encapsulate one or more applications. Furthermore, we associate a ``contract'' with each virtual appliance, which describes its specific behavior in terms of basic resource requirements, user data access needs, and network access specifications. Contracts restrict the virtual appliances to the task that they were designed to do and all other access is denied by default.

This architecture creates a situation in which a virtual appliance that is infected with malware is not able to take over the whole system. The malware will only be able to access a very limited set of the user's personal data and only in the manner specified by the the virtual appliance's contract. By placing applications in virtual appliances, recovery from various system problems, such as malware or malfunctioning applications, is a straight forward process. For example, it is safe to roll back the disk image of a virtual appliance without affecting the user's data, since user data is stored in the FS-VM. 

Our architecture from a network perspective has a set of virtual switches that isolate virtual appliances and the FS-VM from internal and external attack. A network virtual machine (NET-VM) component manages the virtual switches to enforce network policy. Similar to how the FS-VM only allows access to particular data, the NET-VM allows access to specific network segments and only allows traffic flows that are explicitly specified in the virtual appliances' contracts. All other traffic is denied by default at the virtual switch level, which reduces the amount of network processing done on individual virtual machines.

The real benefit with this type of network architecture is that any incoming connection attempts or outgoing connections that are not explicitly allowed by contract rules are denied by the NET-VM at the virtual switch level. This means that even if malware compromises a virtual appliance and opens up a port not specified in the virtual appliance contract, the NET-VM will not allow any incoming traffic to flow to that port. This is a significant improvement compared to firewall-based protection, since the firewall inside the virtual appliance can be disabled, and yet the virtual appliance's networking remains protected by the NET-VM that is controlling the virtual switch or switches that the virtual appliance is connected to. 

We tie together our architecure with a virtualization security framework that we developed, called OSCKAR. OSCKAR is used to manage the interactions between virtual appliances and the enforcement elements (the FS-VM and NET-VM) based on virtual machine contracts and global policy. Even if a malicious entity is able to gain control of a virtual appliance, OSCKAR policy enforcement, from outside of the virtual appliance, can protect the rest of the system. Response to contract violations can lead to restarting a virtual appliance or restoring it to a known good state. OSCKAR provides the framework to provide effective interaction between the underlying virtualization technologies and the higher level file server and network components of our architecture.

\section{Contribution}

This dissertation introduces a number of contributions. These include:

\begin{itemize}

\item The design and implementation of a Rapid Recovery Desktop system based on open source technologies 

\item Construction and integration of a file server virtual machine (FS-VM) component

\item Construction and integration of a network virtual machine (NET-VM) component

\item An implementation of a virtual machine appliance contract system

\item An initial prototye of a generic virtualization security framework, called OSCKAR

\item Application of OSCKAR with our Rapid Recovery Desktop system

\item Evaluation of our Rapid Recovery Desktop system

\end{itemize}

An initial prototype implementation of our Rapid Recovery Desktop system and an initial FS-VM can be found in our previous work\cite{rapid_recovery_paper_05}. In this dissertation we do not seek to innovate on the implementation of the FS-VM component itself, but do contribute some alternative deployment strategies and provide an effective integration of an FS-VM component into our Rapid Recovery Desktop system. In the future work section of Chapter 6, we describe some potential directions that a more advanced FS-VM component could take. The NET-VM component is a new Rapid Recovery Desktop component contributed by this dissertation. It makes use of some of the latest advances in open source virtual switch technology. Also, we show how the NET-VM can be integrated into our Rapid Recovery Desktop system. Further, we have developed a prototype implementation of generic virtualization security framework, that we call OSCKAR, that supports our virtual machine appliance contract system. We describe the generic design of the OSCKAR framework and show its application to the specific application of our Rapid Recovery Desktop system. Finally, we evaluate our current rapid recovery desktop system prototype in terms of performance and effectiveness against attack.

\section{Organization of the Dissertation}

The rest of this dissertation is organized as follows. In Chapter 2, we discuss related work in the areas of virtualization and security. Then, we discuss the design of our system in Chapter 3, followed by the implementation details in Chapter 4. Next, in Chapter 5, we present evaluation in terms of performance and effectiveness. Finally, in Chapter 6, we conclude and present future work.


